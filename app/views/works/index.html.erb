<h1>Collectie <%= @collection.name %></h1>
<%= form_tag collection_works_path, method: :get, authenticity_token: false, data: {auto_submit: true} do %>

  <p id="offline"  data-alert class="alert-box"></p>
    <% if offline? %>
    <div class="row">
      <div class="large-12 columns"><p>Wanneer de applicatie offline gebruikt wordt kan de collectie niet worden weergegeven</p>
      </div>
    </div>
    <% else %>

  <div class="row">
    <div class="large-5 columns">
      <p>Deze <% if @collection_works_count > @works.count %> (gefilterde) <% end %> collectie bevat <%= I18n.translate 'count.works', count:  @works.count %><% if @collection_works_count > @works.count %> (van de <%= I18n.translate 'count.works', count:  @collection_works_count %>).<span class="hide-for-print"><br/> <%= link_to collection_works_path(@collection, params: params.merge({filter:{reset:true}, cluster_new: nil, utf8: nil, action:nil, batch_edit_property: nil, collection_id: nil, controller: nil, authenticity_token: nil, button: nil, no_child_works: nil}) ) do %>Reset filters<% end %><% end %>. <% if qkunst_user? %><span class="select_all hide-for-print tertiary small button inline">Selecteer alles</span><% end %></span></p>



    </div>
    <div class="large-7 columns">
      <div class="right hide-for-print" id="group_sort_display">
        <% unless current_user.read_only? %>
          <label>Groepeer: <%= select_tag :group, options_for_select({
            "Niet"=>:no_grouping,
            "Cluster"=>:cluster,
            "Deelcollectie"=>:subset,
            "Herkomst"=>:sources,
            "Niveau"=>:grade_within_collection,
            "Plaatsbaarheid"=>:placeability,
            "Techniek"=>:techniques,
            "Thema"=>:themes,
          }, @selection[:group]), data: {auto_submit: true}  %></label>
        <% end %>
        <label>Sorteer: <%= select_tag :sort, options_for_select({
          "Inventarisnummer"=>:stock_number,
          "Kunstenaar"=>:artist_name
        }, @selection[:sort]), data: {auto_submit: true}  %></label>
        <label>Weergave: <%= select_tag :display, options_for_select(@selection_display_options, @selection[:display]), data: {auto_submit: true}  %></label>
      </div>
  </div>
  </div>
  <div class="row">
    <aside class="large-2 medium-2 columns filter hide-for-print">
      <h4>Zoeken</h4>
      <%= text_field_tag :q, @search_text, type: :search, placeholder: "Zoeken... "%>
      <p class="hint"><small>Probeer ook: <%=["“wildc*rd”", "“één OR ander”", "“\"exacte match\"”", "“fuzzy~”"].sample(2).join(" of ")%></small></p>
      <h4>Filteren</h4>

      <h5>Thema</h5>
      <%= filter_checkboxes(@aggregations[:themes], "themes.id") %>

      <% unless current_user.read_only? %>
        <h5>Cluster</h5>
        <%= filter_checkboxes(@aggregations[:cluster], "cluster_id") %>

        <h5>Deelcollectie</h5>
        <%= filter_checkboxes(@aggregations[:subset], "subset_id") %>

        <h5>Herkomst</h5>
        <%= filter_checkboxes(@aggregations[:sources], "sources.id") %>

        <h5>Niveau</h5>
        <%= filter_checkboxes(@aggregations[:grade_within_collection], "grade_within_collection") %>

        <h5>Plaatsbaarheid</h5>
        <%= filter_checkboxes(@aggregations[:placeability], "placeability_id") %>

        <h5>Techniek</h5>
        <%= filter_checkboxes(@aggregations[:techniques], "techniques.id") %>

      <% end %>
      <hr/>
      <%= button_tag type: :submit, class: :button do %>Filter<% end %>

      <%= button_tag type: :submit, name: :filter, value: nil, class: :inline do %>Reset filters<% end %>
    </aside>
    <div class="large-10 medium-10 columns" id="works-list">

      <%= Kramdown::Document.new( @collection.description).to_html.html_safe if @collection.description %>


      <% if defined?(@works_grouped) %>
        <% if @works_grouped[nil] %>
          <% works = @works_grouped[nil] %>
          <div class="select_all_scope cluster">
            <h3>Overige werken (geen <%= I18n.t(@selection[:group], scope: [:activerecord,:attributes,:work]).downcase %>)</h3>
            <p>Deze groep bevat <%= I18n.translate 'count.works', count: works.count %>.  <% if qkunst_user? %><span class="select_all hide-for-print tertiary small button inline">Selecteer alles</span></p><% end %>
            <%= render works[0..@max_index]%>
            <% if works.count > @max_index+1%>
            <p><%= link_to "Toon alle #{works.count} werken", collection_works_path(@collection, params: {max_index: 9999999}), class: "hide-for-print button"%></p>
            <% end %>
            </div>
          <hr/>
        <% end %>
        <% @works_grouped.each do |cluster, works| %>
          <% if cluster %>
            <div class="select_all_scope cluster">
              <h3><%= cluster.methods.include?(:name) ? cluster.name : cluster %></h3>
              <p>Deze groep bevat <%= I18n.translate 'count.works', count: works.count %>.  <% if qkunst_user? %><span class="select_all hide-for-print tertiary small button inline">Selecteer alles</span><% end %>. <% if cluster.is_a? Cluster %><span class="hide-for-print"><%= link_to 'Bewerk clusternaam en beschrijving', edit_collection_cluster_path(@collection,cluster) if qkunst_user? %></span><% end %></p>
              <%= Kramdown::Document.new(cluster.description).to_html.html_safe if cluster.methods.include?(:description) and cluster.description%>
              <%= render works[0..@max_index]%>
              <% if works.count > @max_index+1%>
              <p><%= link_to "Toon alle #{works.count} werken", collection_works_path(@collection, params: {max_index: 9999999}), class: "hide-for-print button"%></p>
              <% end %>
            </div>
            <hr/>
          <% end %>
        <% end %>
      <% else %>
        <%= render @works[0..@max_index] %>
        <% if @works.count > (@max_index + 1)%>
          <p><%= link_to "Toon alle #{@works.count} werken", collection_works_path(@collection, params: {max_index: 9999999}), class: "hide-for-print button"%></p>
        <% end %>
      <% end %>
    </div>
  </div>
  <% end %>

  <% content_for :footer do %>
  <p>Dit overzicht is gemaakt op <%= I18n.l Time.now, format: :long %>.</p>
  <% end %>
  <div id="selected-works" class="row">

    <div class="medium-12 columns">

    <p>Verander <span id="selected-works-count">x</span> werken.
      <%= select_tag "batch_edit_property", grouped_options_for_select(@batch_edit_options, params[:batch_edit_property])
%> <label id="new-batch-edit-name">met naam <input name="batch_edit_new_name" type="text" /></label>
<%= button_tag type: :submit, method: :post, value: :batch_edit, name: :batch_edit, class: :button do %>Opslaan<% end %>
    </div>
  </div>
  <%= hidden_field_tag :authenticity_token, form_authenticity_token %>

<% end %>

<script type="text/javascript">
  $(function() {
    var offline_stored_count = (FormStore.Store.count_by_key_start("<%=collection_works_url(@collection)%>"));
    if (offline_stored_count > 0) {
      $('#offline').text("Er zijn "+offline_stored_count+" werk(en) nog niet gesynchroniseerd met de server, zodra de server terug online is worden deze opnieuw geprobeerd");

      // document.getElementById("offline").innerHtml="Er zijn "+offline_stored_count;
    } else {
      $('#offline').hide()
    }
  });
</script>