require 'rails_helper'

RSpec.describe Report::Builder, type: :model do
  describe "aggregation_builder" do
    # for refactoring :)
    it "should work while I'm refactoring" do
      # puts Report::Builder.aggregations
      expected = {
        :total=>{:value_count=>{:field=>:id}},
        :artists=>{:terms=>{:field=>"report_val_sorted_artist_ids.keyword", :size=>999}}, :artists_missing=>{:missing=>{:field=>"report_val_sorted_artist_ids.keyword"}},
        :object_categories=>{:terms=>{:field=>"report_val_sorted_object_category_ids.keyword", :size=>999}, :aggs=>{:techniques=>{:terms=>{:field=>"report_val_sorted_technique_ids.keyword", :size=>999}}, :techniques_missing=>{:missing=>{:field=>"report_val_sorted_technique_ids.keyword"}}}},
        :object_categories_missing=>{:missing=>{:field=>"report_val_sorted_object_category_ids.keyword"}, :aggs=>{:techniques=>{:terms=>{:field=>"report_val_sorted_technique_ids.keyword", :size=>999}}, :techniques_missing=>{:missing=>{:field=>"report_val_sorted_technique_ids.keyword"}}}},
        :object_categories_split=>{:terms=>{:field=>"report_val_sorted_object_category_ids.keyword", :size=>999}, :aggs=>{:techniques=>{:terms=>{:field=>"techniques.id", :size=>999}}, :techniques_missing=>{:missing=>{:field=>"techniques.id"}}}},
        :object_categories_split_missing=>{:missing=>{:field=>"report_val_sorted_object_category_ids.keywords"}, :aggs=>{:techniques=>{:terms=>{:field=>"techniques.id", :size=>999}}, :techniques_missing=>{:missing=>{:field=>"techniques.id"}}}},
        :subset=>{:terms=>{:field=>"subset_id", :size=>999}},
        :cluster=>{:terms=>{:field=>"cluster_id", :size=>999}},
        :style=>{:terms=>{:field=>"style_id", :size=>999}},
        :frame_type=>{:terms=>{:field=>"frame_type_id", :size=>999}},
        :condition_work=>{:terms=>{:field=>"condition_work.id", :size=>999}}, "condition_work_missing"=>{:missing=>{:field=>"condition_work.id"}},
        :condition_frame=>{:terms=>{:field=>"condition_frame.id", :size=>999}}, "condition_frame_missing"=>{:missing=>{:field=>"condition_frame.id"}},
        :sources=>{:terms=>{:field=>"sources.id", :size=>999}}, "sources_missing"=>{:missing=>{:field=>"sources.id"}},
        "tag_list.keyword" => {:terms=>{:field=>"tag_list.keyword", :size=>999}}, "tag_list.keyword_missing" => {:missing=>{:field=>"tag_list.keyword"}},
        :placeability=>{:terms=>{:field=>"placeability.id", :size=>999}}, "placeability_missing"=>{:missing=>{:field=>"placeability.id"}}, :themes=>{:terms=>{:field=>"themes.id", :size=>999}}, "themes_missing"=>{:missing=>{:field=>"themes.id"}}, :damage_types=>{:terms=>{:field=>"damage_types.id", :size=>999}}, :frame_damage_types=>{:terms=>{:field=>"frame_damage_types.id", :size=>999}}, "abstract_or_figurative.keyword"=>{:terms=>{:field=>"abstract_or_figurative.keyword", :size=>999}}, "abstract_or_figurative.keyword_missing"=>{:missing=>{:field=>"abstract_or_figurative.keyword"}}, "grade_within_collection.keyword"=>{:terms=>{:field=>"grade_within_collection.keyword", :size=>999}}, "grade_within_collection.keyword_missing"=>{:missing=>{:field=>"grade_within_collection.keyword"}}, "object_format_code.keyword"=>{:terms=>{:field=>"object_format_code.keyword", :size=>999}}, "object_format_code.keyword_missing"=>{:missing=>{:field=>"object_format_code.keyword"}}, :market_value=>{:terms=>{:field=>"market_value", :size=>999}}, "market_value_missing"=>{:missing=>{:field=>"market_value"}}, :replacement_value=>{:terms=>{:field=>"replacement_value", :size=>999}}, "replacement_value_missing"=>{:missing=>{:field=>"replacement_value"}}, :object_creation_year=>{:terms=>{:field=>"object_creation_year", :size=>999}}, "object_creation_year_missing"=>{:missing=>{:field=>"object_creation_year"}}, :purchase_year=>{:terms=>{:field=>"purchase_year", :size=>999}}, "purchase_year_missing"=>{:missing=>{:field=>"purchase_year"}}, :publish=>{:terms=>{:field=>"publish", :size=>999}}, "publish_missing"=>{:missing=>{:field=>"publish"}}, :image_rights=>{:terms=>{:field=>"image_rights", :size=>999}}, "image_rights_missing"=>{:missing=>{:field=>"image_rights"}}, "location_raw.keyword"=>{:terms=>{:field=>"location_raw.keyword", :size=>999}, :aggs=>{"location_floor_raw.keyword"=>{:terms=>{:field=>"location_floor_raw.keyword", :size=>999}, :aggs=>{"location_detail_raw.keyword"=>{:terms=>{:field=>"location_detail_raw.keyword", :size=>999}}, "location_detail_raw.keyword_missing"=>{:missing=>{:field=>"location_detail_raw.keyword"}}}}, "location_floor_raw.keyword_missing"=>{:missing=>{:field=>"location_floor_raw.keyword"}, :aggs=>{"location_detail_raw.keyword"=>{:terms=>{:field=>"location_detail_raw.keyword", :size=>999}}, "location_detail_raw.keyword_missing"=>{:missing=>{:field=>"location_detail_raw.keyword"}}}}}}, "location_raw.keyword_missing"=>{:missing=>{:field=>"location_raw.keyword"}, :aggs=>{"location_floor_raw.keyword"=>{:terms=>{:field=>"location_floor_raw.keyword", :size=>999}, :aggs=>{"location_detail_raw.keyword"=>{:terms=>{:field=>"location_detail_raw.keyword", :size=>999}}, "location_detail_raw.keyword_missing"=>{:missing=>{:field=>"location_detail_raw.keyword"}}}}, "location_floor_raw.keyword_missing"=>{:missing=>{:field=>"location_floor_raw.keyword"}, :aggs=>{"location_detail_raw.keyword"=>{:terms=>{:field=>"location_detail_raw.keyword", :size=>999}}, "location_detail_raw.keyword_missing"=>{:missing=>{:field=>"location_detail_raw.keyword"}}}}}}}
      expect(Report::Builder.aggregations).to eq(expected)
    end
  end
end
